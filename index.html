<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://cloudbce.com').hostname,
    root: '/',
    scheme: 'Pisces',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="悟已往之不谏 知来者之可追">
<meta property="og:url" content="https://cloudbce.com/index.html">
<meta property="og:site_name" content="悟已往之不谏 知来者之可追">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Wang Yian">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://cloudbce.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>悟已往之不谏 知来者之可追</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">悟已往之不谏 知来者之可追</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://cloudbce.com/2020/10/31/%E6%88%91%E7%9A%84%E5%AA%92%E4%BD%93%E6%88%90%E9%95%BF%E6%97%A5%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wang Yian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="悟已往之不谏 知来者之可追">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/31/%E6%88%91%E7%9A%84%E5%AA%92%E4%BD%93%E6%88%90%E9%95%BF%E6%97%A5%E8%AE%B0/" class="post-title-link" itemprop="url">我的媒体成长日记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-31 10:45:51" itemprop="dateCreated datePublished" datetime="2020-10-31T10:45:51+08:00">2020-10-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-11-17 21:03:16" itemprop="dateModified" datetime="2020-11-17T21:03:16+08:00">2020-11-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>10月最后一天，在家里的书桌上，开启了这篇成长日记。 媒体技术一开始并不觉得多好玩， 但是慢慢的接触了点后，发现还是挺有趣的，而媒体技术本身也没有系统的教程可以学习，目前我只能在工作中摸索，一天天的积累，希望这篇成长日记能够坚持写下去, 在媒体领域能有所耕耘。 </p>
<h2 id="成长日志"><a href="#成长日志" class="headerlink" title="成长日志"></a>成长日志</h2><h3 id="2020-11-16"><a href="#2020-11-16" class="headerlink" title="2020/11/16"></a>2020/11/16</h3><p>srs的线程模型选择的是st协程库，基本实现原理是setjmp和longjmp.</p>
<p><a target="_blank" rel="noopener" href="http://www.csl.mtu.edu/cs4411.ck/www/NOTES/non-local-goto/coroutine.html">jmp coroutine</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/82492121">setjmp是如何工作的</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/48219407">State-Thread</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">jmp_buf env;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">my_func</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;do not allow division by 0\n&quot;</span>);</span><br><span class="line">        longjmp(env, <span class="number">1</span>); <span class="comment">// 将env设置为1， 跳转到setjmp的地方</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a / b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = setjmp(env);  <span class="comment">// 保存上下文信息，res == 0, 进入my_func</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (res == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;return from setjmp\n&quot;</span>);</span><br><span class="line">        my_func(<span class="number">10</span>, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//回来以后 res 是1</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;return from longjmp: %d\n&quot;</span>, res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>吐槽:<br>srs的代码虽然是C++写的，但是代码风格实在不是c++。 srs的业务逻辑和st线程库是主要学习部分。</p>
<h3 id="2020-11-12"><a href="#2020-11-12" class="headerlink" title="2020/11/12"></a>2020/11/12</h3><ul>
<li>RTMP相比较http-flv更适合抓包调试， 因为wireshark支持RTMP内容解析， 而不支持HTTP-FLV内容解析。 wireshark分析rtmp的时候要注意， 需要配置下protocol-&gt;rmtp-&gt;port，如果媒体服务器不是标准的1935端口的话。 </li>
<li>RTMP Command格式是Rtmp Header + Body。 Header指出 时间戳 + 流ID + Body Size + AMF版本，Body则是使用AMF格式存储的。 明天需要看下AMF格式。</li>
</ul>
<blockquote>
<p>264是Annex B封装， 不符合rtmp的规范. so what is Annex ?<br>AES-256-CBC.  Advance Encrytion Stand. 256 — 密钥的长度. CBC (Cipher Block Chainning) 将明文切为若干段，每一段与初始段或者上一段密文进行或操作后，再与密钥进行加密。 </p>
</blockquote>
<hr>
<h3 id="2020-11-10"><a href="#2020-11-10" class="headerlink" title="2020/11/10"></a>2020/11/10</h3><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/YUV">YUV</a>和IDR</p>
<p>Y – 亮度<br>U – 色度<br>V – 浓度</p>
<ol>
<li>YUV也是使用RGB，不过编码方式不同，有点在于可以节约存储空间的同时带来相同的视觉效果。 </li>
<li>IDR（及时刷新编码）是I帧的一种，不过IDR帧是第1个首个I帧，编码出现错误的情况下，用IDR帧来隔离错误， 因为IDR帧后面的BP帧不会参考IDR帧前面的I帧，起到隔离的作用。 </li>
</ol>
<hr>
<h3 id="2020-11-08-09"><a href="#2020-11-08-09" class="headerlink" title="2020/11/08 - 09"></a>2020/11/08 - 09</h3><p>参考srs代码，实现了简单握手协议（才发现还有复杂握手），本质上还是有限状态机。</p>
<p><a href=""https://github.com/pianzhoujun/RtmpSdk/commit/6370666b94832dfa8efe8a26719dd45be8dd1f51"">commits</a></p>
<p>总结：</p>
<ol>
<li>握手有简单握手和复杂握手，本次实现的是简单握手，复杂握手还没有实现。 </li>
<li>rtmp每个字段都要显示的将字节“小端”存储，看不出来有没有好处，可以再研究下。 </li>
<li>握手完成后，需要立刻发送connect指令， 否则srs会立刻将tcp连接给断开。 </li>
<li>muduo网络库”简单”好用, 当前的封装还不好，需要重构，不过对本次的目标而言，是实现简单的推流，代码结构后面再考虑。 </li>
</ol>
<p>同事有分享一个关于流媒体的博客，Mark下</p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/6844903555141238791">流媒体名词解释</a></p>
<hr>
<h3 id="2020-11-07"><a href="#2020-11-07" class="headerlink" title="2020/11/07"></a>2020/11/07</h3><p>按照我的计划，实现一个简单的rtmpsdk，进行推\拉流，底层的事件处理框架我选择muduo, 因为muduo本身好理解。 </p>
<ul>
<li>语言: C++</li>
<li>构建工具: cmake</li>
<li>运行环境: docker/ubuntu</li>
<li>媒体Server: srs3</li>
</ul>
<p>今天的目标是建立TCP连接。 </p>
<p>目录结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">|-- CMakeLists.txt</span><br><span class="line">|-- build</span><br><span class="line">|   |-- CMakeCache.txt</span><br><span class="line">|   |-- CMakeFiles</span><br><span class="line">|   |-- Makefile</span><br><span class="line">|   |-- cmake_install.cmake</span><br><span class="line">|   `-- rtmpsdk</span><br><span class="line">|-- include</span><br><span class="line">|   |-- muduo</span><br><span class="line">|   `-- rtmp_client.h</span><br><span class="line">|-- lib</span><br><span class="line">|   |-- libmuduo_base.a</span><br><span class="line">|   |-- libmuduo_http.a</span><br><span class="line">|   |-- libmuduo_inspect.a</span><br><span class="line">|   |-- libmuduo_net.a</span><br><span class="line">|   `-- libmuduo_pubsub.a</span><br><span class="line">|-- main.cpp</span><br><span class="line">`-- src</span><br><span class="line">    `-- rtmp_client.cpp</span><br></pre></td></tr></table></figure>

<p>将编译好的muduo lib和include文件放到lib和include中。 build目录编译产出。代码不全贴了，明天可以创建个代码库。 </p>
<p>rtmp_client.cpp</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;rtmp_client.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RtmpClient::on_connection</span><span class="params">(<span class="keyword">const</span> mn::TcpConnectionPtr&amp; conn_ptr)</span> </span>&#123;</span><br><span class="line">  LOG_INFO &lt;&lt; conn_ptr-&gt;localAddress().toIpPort() &lt;&lt; <span class="string">&quot; -&gt; &quot;</span></span><br><span class="line">           &lt;&lt; conn_ptr-&gt;peerAddress().toIpPort()</span><br><span class="line">           &lt;&lt; (conn_ptr-&gt;connected() ? <span class="string">&quot; UP&quot;</span> : <span class="string">&quot; DOWN&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!conn_ptr-&gt;connected()) &#123;</span><br><span class="line">    _loop-&gt;quit();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RtmpClient::on_message</span><span class="params">(<span class="keyword">const</span> mn::TcpConnectionPtr&amp; conn_ptr, mn::Buffer* buffer,</span></span></span><br><span class="line"><span class="function"><span class="params">                            muduo::Timestamp rcv_time)</span> </span>&#123;</span><br><span class="line">  buffer-&gt;retrieveAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./rtmpsdk</span><br><span class="line">20201107 09:13:21.902418Z  1551 INFO  TcpClient::TcpClient[RtmpClient] - connector 0x56464DF046F0 - TcpClient.cc:69</span><br><span class="line">20201107 09:13:21.902479Z  1551 INFO  TcpClient::connect[RtmpClient] - connecting to 10.138.33.16:8935 - TcpClient.cc:107</span><br><span class="line">20201107 09:13:21.940659Z  1551 INFO  172.17.0.2:49136 -&gt; 10.138.33.16:8935 UP - rtmp_client.cpp:5</span><br></pre></td></tr></table></figure>

<p>明天实现握手。 </p>
<hr>
<h3 id="2020-11-06"><a href="#2020-11-06" class="headerlink" title="2020/11/06"></a>2020/11/06</h3><p>罗小灰得了细小，很郁闷，想到罗小灰最近的样子就很难受。 不过这块的学习还是不能松懈。</p>
<p>AMF(Action Message Format), RTMP协议里面的序列化协议。 看了<a target="_blank" rel="noopener" href="https://juejin.im/user/1134351728250568">老司机的博客</a>, 确实，要深入理解这个RTMP协议，可以实现一个简单的RTMP客户端，结合最近看的Muduo网络库，倒是可以结合起来，嗯，给自己定个目标，4天时间内实现握手协议。 后面结合FLV协议的学习，实现RTMP推流和RTMP/FLV-HTTP拉流。  </p>
<hr>
<h3 id="2020-11-05"><a href="#2020-11-05" class="headerlink" title="2020/11/05"></a>2020/11/05</h3><ul>
<li>RTMP的握手好像除了同步时间戳以外似乎没有作用， 另外onFCPublish一开始是Adobe给FLV编码器发的消息，后面的实现大家都沿用了，所以也没啥用，冗余信息。 </li>
<li>RTMP Chunk Streaming ID是在Chunk中标识流，这个ID是客户端指定的，一条流里面的Chunk Streaming ID是相同的。   </li>
<li>为什么要有Chunk?  因为有Audio/Video/Control信息， 需要穿插着发送, 才能正常流畅的播放。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0f8354a53d5b">RTMP Spec 中文</a></p>
<hr>
<h3 id="2020-11-04"><a href="#2020-11-04" class="headerlink" title="2020/11/04"></a>2020/11/04</h3><p>今天主要是要看下RTMP基础，了解基本的原理。  主要看了<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b2144f9bbe28">博客</a>，抓包看了下过程。</p>
<p>RTMP/Real Time Message Procol.<br>RTMP主要解决流媒体传输时多路复用和分包问题。 底层使用TCP，不过随着QUIC的出现，现在部分厂商也开始实现RTMP over QUIC了 </p>
<p>RTMP属于应用层协议，不过开始传输之前先要握手， 看抓包过程知识确认了下版本号:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C        ---------------        S</span><br><span class="line">c0 + c1  --------------&gt; </span><br><span class="line">         &lt;--------------  s0 + s1 + s2  and version</span><br><span class="line">c2       --------------&gt;  &#x2F;&#x2F; handshark done</span><br></pre></td></tr></table></figure>

<p><img src="/images/rtmp-connect.png"></img></p>
<p>握手完，开始发消息(Message)，消息应该也是分控制消息和实际数据消息.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C             ---------------        S</span><br><span class="line">connect(wgs)  --------------&gt; &#x2F;&#x2F; wgs是app的名， RTMP消息也分为Header\Body， 其中Header里面有消息ID， 不过AMF0是什么意思？</span><br><span class="line">              &lt;--------------       set AcknowagementSize</span><br><span class="line">              &lt;--------------       set Peer Bandwidth &amp; Chunk Size</span><br><span class="line">releaseStream --------------&gt;</span><br><span class="line">FCPublish     --------------&gt; &#x2F;&#x2F; 因为是要推流，因此是Publish指令</span><br></pre></td></tr></table></figure>

<p>发送视频之前会发送视频的基本信息， @setDataFrame, 包括了视频的长度、宽度、帧率、编码器等等，这些又和FLV是相似的。 HTTP-FLV协议后面做个TODO来学习。  </p>
<p>RTMP消息分7类，connect\publish属于Command Message, Audio\Video Message作为2类， @setDataFramg属于Data Message, 还有其他的。   </p>
<p>明天得看下RTMP Chunk格式， 那么RTMP最基本的就欻不多了， 后面再查下相关的RFC. </p>
<hr>
<h3 id="2020-11-03"><a href="#2020-11-03" class="headerlink" title="2020/11/03"></a>2020/11/03</h3><p>今天补习下基础知识，分辨率、像素、码率。 </p>
<p>分辨率，分2块，一个是屏幕分辨率，一个是图像分辨率，还有像素点。<br>屏幕分辨率。 比如我的mbp，分辨率是2560 x 1600, 就是说将屏幕划分了2560 x 1600一共409.6w像素点。 一张图片的分辨率是320 x 240，说明图片的像素点有7.68w个像素点。<br>对于一个固定大小的显示器而言，显示器的分辨率越高，则可以容纳的像素点越多，比如一张分辨率2560 x 1600图片可以填充全网电脑的每一个像素点, 对应的一张320 x 240的图片，如果在屏幕上铺开的话，一个图片的像素点则会占屏幕的N个像素点，这样的话显示的就会看起来马赛克了。 如果图片分辨率大于显示器的分辨率的时候，多个像素点会合并，那么一个像素点上承载的信息就越多。 </p>
<p><strong>像素</strong><br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%83%8F%E7%B4%A0">维基百科</a>里面有这样一段话:</p>
<blockquote>
<p>像素通常被视为影像的最小完整取样。<br>照片是一个个取样点的集合。</p>
</blockquote>
<p>取样是对原画的取样，这样的话，采样率也就好理解了，图像、声音都是从真实世界的一个采样，只能无限接近，不会完全相同。 </p>
<blockquote>
<p>pixel. pi(picture) el(element)</p>
</blockquote>
<p>看像素的时候，链接到了<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%8E%9F%E8%89%B2">原色</a>，唤醒了我初中生物课学到的知识。 原来RGB的原理是这么简单， 原色是生理概念， 通过RGB 3种颜色的叠加生成其他的颜色.  </p>
<p>这样就有，那么像素用位图来表示我就能够理解了。  一个颜色用多少位（bit)来表示就是<strong>位深度</strong>， 位深度是1则是黑白的，位深度是8位，则可以表示256个颜色， RGB需要3个Byte来编码一个颜色，R\G\B分别有256个亮度，所以有256种可能，RGB组合的颜色有256 x 256 x 256 = 2^24 = 16777216种， 使用RGB编码颜色的话，一个像素需要有3个字节来表示。  <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/RGB">百度百科</a></p>
<blockquote>
<p>256级的RGB，因为用2^24个组合，因此也叫24位色。</p>
</blockquote>
<p>像素点就是一个色块\位图（图像就图画，各种颜色的组合）。 </p>
<p><strong>ppi</strong><br>pixels per inch, 一英寸内像素点的数量。 </p>
<p><strong>码率</strong>。<br>经常听同事说到码率码率，可是我一直没搞清楚码率到底是啥。 今天可算清楚了，这位老哥说的—&gt;<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/028196b8ca14">这里</a>,  </p>
<blockquote>
<p>简单的来说就是压缩视频的时候通过一个参数告诉压缩软件，我期望压缩出来的后的视频的大小。 码率越高，则压缩比越小，视频越接近原画。 码率越高，则需要的带宽也就越多，对应的在cdn分发的时候，需要的费用也就越高了。 </p>
</blockquote>
<hr>
<h3 id="2020-11-02"><a href="#2020-11-02" class="headerlink" title="2020/11/02"></a>2020/11/02</h3><p>部署个srs 3.0，推流和拉流先跑跑看看。</p>
<p>step 1. 环境部署<br>在开发机上手动编译安转，很顺利： <a target="_blank" rel="noopener" href="https://github.com/ossrs/srs">https://github.com/ossrs/srs</a></p>
<p>step 2. 修改配置文件</p>
<p>修改端口号，1935 -&gt; 8935, 1985 -&gt; 8985</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main config for srs.</span></span><br><span class="line"><span class="comment"># @see full.conf for detail config.</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">listen</span>              <span class="number">8935</span>;</span><br><span class="line"><span class="attribute">max_connections</span>     <span class="number">1000</span>;</span><br><span class="line"><span class="attribute">srs_log_tank</span>        file;</span><br><span class="line"><span class="attribute">srs_log_file</span>        ./objs/srs.log;</span><br><span class="line"><span class="attribute">daemon</span>              <span class="literal">on</span>;</span><br><span class="line"><span class="section">http_api</span> &#123;</span><br><span class="line">    <span class="attribute">enabled</span>         <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">listen</span>          <span class="number">8985</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http_server</span> &#123;</span><br><span class="line">    <span class="attribute">enabled</span>         <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">listen</span>          <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">dir</span>             ./objs/nginx/html;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">stats</span> &#123;</span><br><span class="line">    <span class="attribute">network</span>         <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">disk</span>            sda sdb xvda xvdb;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">vhost</span> __defaultVhost__ &#123;</span><br><span class="line">    <span class="section">hls</span> &#123;</span><br><span class="line">        <span class="attribute">enabled</span>         <span class="literal">on</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">http_remux</span> &#123;</span><br><span class="line">        <span class="attribute">enabled</span>     <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">mount</span>       [vhost]/[app]/[stream].flv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中8985是用来配置rtmp端口的， 另外flv和m3u8通过8080端口访问。 8985应该是管理端口。</p>
<ul>
<li><p>推流</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -re -i wgs-dev.flv -vcodec copy -acodec copy -f flv -y <span class="string">&#x27;rtmp://wgs-push.baidu.com:8935/wgs/test-20201030&#x27;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>播放</p>
</li>
</ul>
<ol>
<li>rtmp</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffplay rtmp://wgs-push.baidu.com:8935/wgs/test-20201030</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>http-flv</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffplay http://wgs-push.baidu.com:8080/wgs/test-20201030.flv</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>m3u8</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffplay rtmp://wgs-push.baidu.com:8080/wgs/test-20201030.m3u8</span><br></pre></td></tr></table></figure>

<p>srs 日志</p>
<p>将hls关闭以后重启，推rtmp，拉rtmp和flv， 日志里面的会有publish\create consumer\dispatch cached gop success… 这些名词是什么意思呢？:)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">50</span>:<span class="number">06.168</span>][Trace][<span class="number">29798</span>][<span class="number">428</span>] server main cid=<span class="number">428</span>, pid=<span class="number">29798</span>, ppid=<span class="number">29795</span>, asprocess=<span class="number">0</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">50</span>:<span class="number">06.168</span>][Trace][<span class="number">29798</span>][<span class="number">428</span>] write pid=<span class="number">29798</span> to ./objs/srs.pid success!</span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">50</span>:<span class="number">06.168</span>][Warn][<span class="number">29798</span>][<span class="number">428</span>][<span class="number">22</span>] SO_REUSEPORT is <span class="keyword">not</span> supported util Linux kernel <span class="number">3.9</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">50</span>:<span class="number">06.168</span>][Trace][<span class="number">29798</span>][<span class="number">428</span>] RTMP listen at tcp:<span class="comment">//0.0.0.0:8935, fd=8</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">50</span>:<span class="number">06.168</span>][Warn][<span class="number">29798</span>][<span class="number">428</span>][<span class="number">22</span>] SO_REUSEPORT is <span class="keyword">not</span> supported util Linux kernel <span class="number">3.9</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">50</span>:<span class="number">06.168</span>][Trace][<span class="number">29798</span>][<span class="number">428</span>] HTTP-API listen at tcp:<span class="comment">//0.0.0.0:8985, fd=9</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">50</span>:<span class="number">06.168</span>][Warn][<span class="number">29798</span>][<span class="number">428</span>][<span class="number">22</span>] SO_REUSEPORT is <span class="keyword">not</span> supported util Linux kernel <span class="number">3.9</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">50</span>:<span class="number">06.168</span>][Trace][<span class="number">29798</span>][<span class="number">428</span>] HTTP-Server listen at tcp:<span class="comment">//0.0.0.0:8080, fd=10</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">50</span>:<span class="number">06.168</span>][Trace][<span class="number">29798</span>][<span class="number">428</span>] signal installed, reload=<span class="number">1</span>, reopen=<span class="number">10</span>, fast_quit=<span class="number">15</span>, grace_quit=<span class="number">3</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">50</span>:<span class="number">06.168</span>][Trace][<span class="number">29798</span>][<span class="number">428</span>] http: api mount /console to ./objs/nginx/html/console</span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">17.490</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] RTMP client ip=<span class="number">172.18</span><span class="number">.17</span><span class="number">.90</span>, fd=<span class="number">11</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">17.519</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] simple handshake success.</span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">17.519</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] connect app, tcUrl=rtmp:<span class="comment">//wgs-push.baidu.com:8935/wgs, pageUrl=, swfUrl=, schema=rtmp, vhost=wgs-push.baidu.com, port=8935, app=wgs, args=null</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">17.519</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] protocol in.buffer=<span class="number">0</span>, in.ack=<span class="number">0</span>, out.ack=<span class="number">0</span>, in.chunk=<span class="number">128</span>, out.chunk=<span class="number">128</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">17.575</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] client identified, type=fmle-publish, vhost=wgs-push.baidu.com, app=wgs, stream=test<span class="number">-20201030</span>, param=, duration=<span class="number">0</span>ms</span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">17.575</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] connected stream, tcUrl=rtmp:<span class="comment">//wgs-push.baidu.com:8935/wgs, pageUrl=, swfUrl=, schema=rtmp, vhost=__defaultVhost__, port=8935, app=wgs, stream=test-20201030, param=, args=null</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">17.575</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] connected stream, tcUrl=rtmp:<span class="comment">//wgs-push.baidu.com:8935/wgs, pageUrl=, swfUrl=, schema=rtmp, vhost=__defaultVhost__, port=8935, app=wgs, stream=test-20201030, param=, args=null</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">17.575</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] source url=/wgs/test<span class="number">-20201030</span>, ip=<span class="number">172.18</span><span class="number">.17</span><span class="number">.90</span>, cache=<span class="number">1</span>, is_edge=<span class="number">0</span>, source_id=<span class="number">0</span>/<span class="number">0</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">17.630</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] ignore disabled exec <span class="keyword">for</span> vhost=__defaultVhost__</span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">17.630</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] http: mount flv stream <span class="keyword">for</span> sid=/wgs/test<span class="number">-20201030</span>, mount=/wgs/test<span class="number">-20201030.f</span>lv</span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">17.630</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] start publish mr=<span class="number">0</span>/<span class="number">350</span>, p1stpt=<span class="number">20000</span>, pnt=<span class="number">5000</span>, tcp_nodelay=<span class="number">0</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">17.687</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] got metadata, width=<span class="number">1280</span>, height=<span class="number">720</span>, vcodec=<span class="number">7</span>, acodec=<span class="number">2</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">17.687</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] <span class="number">45B</span> video sh,  codec(<span class="number">7</span>, profile=High, level=<span class="number">3.1</span>, <span class="number">1280</span>x720, <span class="number">0</span>kbps, <span class="number">0.0f</span>ps, <span class="number">0.0</span>s)</span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">42.630</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] &lt;- CPB time=<span class="number">20000420</span>, okbps=<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>, ikbps=<span class="number">1243</span>,<span class="number">0</span>,<span class="number">0</span>, mr=<span class="number">0</span>/<span class="number">350</span>, p1stpt=<span class="number">20000</span>, pnt=<span class="number">5000</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">52.630</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] &lt;- CPB time=<span class="number">30000456</span>, okbps=<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>, ikbps=<span class="number">1462</span>,<span class="number">1190</span>,<span class="number">0</span>, mr=<span class="number">0</span>/<span class="number">350</span>, p1stpt=<span class="number">20000</span>, pnt=<span class="number">5000</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">57.524</span>][Trace][<span class="number">29798</span>][<span class="number">436</span>] HTTP client ip=<span class="number">172.18</span><span class="number">.17</span><span class="number">.90</span>, request=<span class="number">0</span>, to=<span class="number">15000</span>ms</span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">57.524</span>][Trace][<span class="number">29798</span>][<span class="number">436</span>] HTTP GET http:<span class="comment">//wgs-push.baidu.com:8080/wgs/test-20201030.flv, content-length=-1</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">57.524</span>][Trace][<span class="number">29798</span>][<span class="number">436</span>] dispatch cached gop success. count=<span class="number">291</span>, duration=<span class="number">4431</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">57.524</span>][Trace][<span class="number">29798</span>][<span class="number">436</span>] create consumer, active=<span class="number">1</span>, queue_size=<span class="number">0.00</span>, jitter=<span class="number">30000000</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">57.524</span>][Trace][<span class="number">29798</span>][<span class="number">436</span>] create consumer, active=<span class="number">1</span>, queue_size=<span class="number">0.00</span>, jitter=<span class="number">30000000</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">57.524</span>][Trace][<span class="number">29798</span>][<span class="number">436</span>] <span class="built_in">set</span> fd=<span class="number">12</span>, SO_SNDBUF=<span class="number">87040</span>=&gt;<span class="number">175000</span>, buffer=<span class="number">350</span>ms</span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">57.524</span>][Trace][<span class="number">29798</span>][<span class="number">436</span>] FLV /wgs/test<span class="number">-20201030.f</span>lv, encoder=FLV, nodelay=<span class="number">0</span>, mw_sleep=<span class="number">350</span>ms, cache=<span class="number">0</span>, msgs=<span class="number">128</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">51</span>:<span class="number">57.524</span>][Trace][<span class="number">29798</span>][<span class="number">436</span>] FLV: write header audio=<span class="number">1</span>, video=<span class="number">1</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">52</span>:<span class="number">02.630</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] &lt;- CPB time=<span class="number">40000590</span>, okbps=<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>, ikbps=<span class="number">1688</span>,<span class="number">1190</span>,<span class="number">0</span>, mr=<span class="number">0</span>/<span class="number">350</span>, p1stpt=<span class="number">20000</span>, pnt=<span class="number">5000</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">52</span>:<span class="number">07.443</span>][Trace][<span class="number">29798</span>][<span class="number">436</span>] -&gt; HTS http: got <span class="number">23</span> msgs, age=<span class="number">10000019</span>, min=<span class="number">8</span>, mw=<span class="number">350</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">52</span>:<span class="number">12.630</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] &lt;- CPB time=<span class="number">50000609</span>, okbps=<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>, ikbps=<span class="number">1799</span>,<span class="number">1190</span>,<span class="number">0</span>, mr=<span class="number">0</span>/<span class="number">350</span>, p1stpt=<span class="number">20000</span>, pnt=<span class="number">5000</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">52</span>:<span class="number">17.377</span>][Trace][<span class="number">29798</span>][<span class="number">436</span>] -&gt; HTS http: got <span class="number">23</span> msgs, age=<span class="number">20000063</span>, min=<span class="number">8</span>, mw=<span class="number">350</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">52</span>:<span class="number">22.630</span>][Trace][<span class="number">29798</span>][<span class="number">434</span>] &lt;- CPB time=<span class="number">60000653</span>, okbps=<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>, ikbps=<span class="number">1828</span>,<span class="number">2453</span>,<span class="number">0</span>, mr=<span class="number">0</span>/<span class="number">350</span>, p1stpt=<span class="number">20000</span>, pnt=<span class="number">5000</span></span><br><span class="line">[<span class="number">2020</span><span class="number">-11</span><span class="number">-02</span> <span class="number">11</span>:<span class="number">52</span>:<span class="number">27.486</span>][Trace][<span class="number">29798</span>][<span class="number">436</span>] -&gt; HTS http: got <span class="number">8</span> msgs, age=<span class="number">30000164</span>, min=<span class="number">8</span>, mw=<span class="number">350</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2020-10-31"><a href="#2020-10-31" class="headerlink" title="2020/10/31"></a>2020/10/31</h3><p>SRS(Simple Rtmp(real time message protocol) Sever).  nginx-rtmp也是rtmp server, 但是单进程srs性能更强。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ossrs/srs/wiki/v1_CN_Home">https://github.com/ossrs/srs/wiki/v1_CN_Home</a></p>
<p>Ingest — 采集， 简单理解为SRS拉流。<br><a target="_blank" rel="noopener" href="https://github.com/ossrs/srs/wiki/v1_CN_Ingest">https://github.com/ossrs/srs/wiki/v1_CN_Ingest</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://cloudbce.com/2020/11/16/aes-cbc-256/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wang Yian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="悟已往之不谏 知来者之可追">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/16/aes-cbc-256/" class="post-title-link" itemprop="url">aes-cbc-256</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-11-16 23:05:56 / Modified: 23:15:14" itemprop="dateCreated datePublished" datetime="2020-11-16T23:05:56+08:00">2020-11-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>明文分组加密</p>
<p>AES - Advance Encryption Standard<br>256 - 密钥长度<br>CBC - Cipher Block Chaining (将明文切为若干段，每一段与初始块或者上一段密文进行或操作后，再与密钥进行加密)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aes_cbc_encrypt</span>(<span class="params">data, password, iv</span>):</span></span><br><span class="line">    bs = AES.block_size</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">s</span>):</span> </span><br><span class="line">        <span class="keyword">return</span> s + (bs - len(s) % bs) * <span class="string">b&#x27;0&#x27;</span></span><br><span class="line"></span><br><span class="line">    cipher = AES.new(password, mode=AES.MODE_CBC, IV=iv)</span><br><span class="line">    data = cipher.encrypt(pad(data))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> base64.urlsafe_b64encode(version + data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aes_cbc_decrypt</span>(<span class="params">data, password</span>):</span></span><br><span class="line">    bs = AES.block_size</span><br><span class="line">    <span class="keyword">if</span> len(data) &lt;= bs:</span><br><span class="line">        <span class="keyword">return</span> (data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">unpad</span>(<span class="params">s</span>):</span> </span><br><span class="line">        <span class="keyword">return</span> s[<span class="number">0</span>:-s[<span class="number">-1</span>]]</span><br><span class="line"></span><br><span class="line">    iv = data[:bs]</span><br><span class="line">    cipher = AES.new(password, AES.MODE_CBC, iv)</span><br><span class="line">    data = unpad(cipher.decrypt(data[bs:]))</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://cloudbce.com/2020/10/24/book-list/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wang Yian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="悟已往之不谏 知来者之可追">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/24/book-list/" class="post-title-link" itemprop="url">我的书单</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-24 15:01:44" itemprop="dateCreated datePublished" datetime="2020-10-24T15:01:44+08:00">2020-10-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-11-16 23:13:03" itemprop="dateModified" datetime="2020-11-16T23:13:03+08:00">2020-11-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="我的书单"><a href="#我的书单" class="headerlink" title="我的书单"></a>我的书单</h3><table>
<thead>
<tr>
<th align="left">时间</th>
<th align="left">书名</th>
<th align="left">作者</th>
</tr>
</thead>
<tbody><tr>
<td align="left">2020.10.24</td>
<td align="left">为什么精英都是时间控</td>
<td align="left">桦泽紫苑</td>
</tr>
<tr>
<td align="left">2020.10.27</td>
<td align="left">为什么精英这样用脑不会累</td>
<td align="left">桦泽紫苑</td>
</tr>
<tr>
<td align="left">2020.10.31</td>
<td align="left">Linux多线程服务端编程 使用muduo C++网络库</td>
<td align="left">陈硕</td>
</tr>
<tr>
<td align="left">2020.11.03</td>
<td align="left">为什么精英沟通最高效</td>
<td align="left">桦泽紫苑</td>
</tr>
<tr>
<td align="left">2020.11.15</td>
<td align="left">人体简史</td>
<td align="left">比尔 布莱森</td>
</tr>
<tr>
<td align="left">ing</td>
<td align="left">论可计算数 图灵与现代计算的诞生</td>
<td align="left">克里斯-伯恩哈特</td>
</tr>
<tr>
<td align="left">todo</td>
<td align="left">ttps://item.jd.com/12148832.html 图解算法</td>
<td align="left">巴尔加瓦（美）</td>
</tr>
</tbody></table>
<h3 id="读后感"><a href="#读后感" class="headerlink" title="读后感"></a>读后感</h3><h4 id="论可计算数-图灵与现代计算的诞生"><a href="#论可计算数-图灵与现代计算的诞生" class="headerlink" title="论可计算数 图灵与现代计算的诞生"></a>论可计算数 图灵与现代计算的诞生</h4><p>读这本书之前我已经再次准备写博客，我一直多有写博客的愿望，但是一直断断续续的。这本书告诉我，通过坚持写博客， 将自己的学到的东西、自己的感受写出来，可以加深对知识的理解，是的，所有的输入是为输出服务的，虽然不全对，但是在学习中，这点是正确的。 看吧，我货已经坚持写博客3天了， 不管是啥， 我都要写一下，整理清楚，输出的同时，记录学习的过程，加深理解。 这是这本书带给我最大的收获把。  — 2020/11/03</p>
<h4 id="为什么精英都是时间控"><a href="#为什么精英都是时间控" class="headerlink" title="为什么精英都是时间控"></a>为什么精英都是时间控</h4><p>我觉得书名翻译的不好，叫做神之时间管理术更恰当点。 </p>
<p>对于我们程序员而言，特别是做云服务行业的，每天要面对的除了代码以外，还有很多客户的问题，很多时候会被打断，一天结束的时候也不知道这一天到底做了什么， 经常加班，和家人在一起的时间较少。  </p>
<p>而这本书告诉我，其实程序员如果能管理好时间，运用好自己的大脑，工作和生活能够得到很好的平衡，白天高效率工作，晚上就好好休息，<strong>投资自己</strong>，正向反馈于工作。 </p>
<h4 id="为什么精英这样用脑不会累"><a href="#为什么精英这样用脑不会累" class="headerlink" title="为什么精英这样用脑不会累"></a>为什么精英这样用脑不会累</h4><p>桦泽紫苑精英系列第2本书， 这本书阐述了几大脑内物质的作用，去甲肾上腺素、肾上腺素、多巴胺、内啡肽、褪黑素等，如何运用这几大脑内物质来提高自己的状态，无论是工作状态还是生活状态。<br>这本书很有趣，对我的生活和工作打来了积极的影响，结合自己的情况和书中的建议，工作效率和生活状态都有改善。 一开始还不太习惯，暖暖告诉我，可以把上班的时候，几点到几点做了什么记录下来，然后反思这个时间段内做的事情还能不能再提高下效率，这个方法是很有效的，知道自己时间是怎么分配的，是不是科学的、有效的。 </p>
<p>我想《为什么精英都是时间控》和 《为什么精英这样用脑不会累》这2本书给我最大的影响是，认识自己工作状态其实是懒散、低效的，然后如何改掉这些个习惯， 成为更好的自己。 </p>
<h4 id="Linux多线程服务端编程-使用muduo-C-网络库"><a href="#Linux多线程服务端编程-使用muduo-C-网络库" class="headerlink" title="Linux多线程服务端编程 使用muduo C++网络库"></a>Linux多线程服务端编程 使用muduo C++网络库</h4><p>看桦泽紫苑书的前后，重新翻了下muduo网络库和源码。 这本书解答了我在工作中遇到但是一直没有好好看的一些事件\多线程\Reactor的一些知识点，在百度，王华勇在分享C++高阶编程的时候，有说到，好的代码是一看就会，一改就对，我想，muduo网络库是做到了这点的，其中有些设计我也应用到实际工程中去了，对我的工程能力提升也有很大的帮助，感谢作者。 </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://cloudbce.com/2020/09/30/Muduo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wang Yian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="悟已往之不谏 知来者之可追">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/30/Muduo/" class="post-title-link" itemprop="url">Muduo</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-30 18:13:40" itemprop="dateCreated datePublished" datetime="2020-09-30T18:13:40+08:00">2020-09-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-31 10:10:40" itemprop="dateModified" datetime="2020-10-31T10:10:40+08:00">2020-10-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="/images/mudo-event.drawio.svg"></img></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://cloudbce.com/2020/09/29/etcd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wang Yian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="悟已往之不谏 知来者之可追">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/29/etcd/" class="post-title-link" itemprop="url">etcd</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-09-29 19:22:42 / Modified: 19:24:48" itemprop="dateCreated datePublished" datetime="2020-09-29T19:22:42+08:00">2020-09-29</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="RAFT"><a href="#RAFT" class="headerlink" title="RAFT"></a>RAFT</h2><p><a target="_blank" rel="noopener" href="http://thesecretlivesofdata.com/raft/">http://thesecretlivesofdata.com/raft/</a></p>
<p><a target="_blank" rel="noopener" href="https://techthoughts.typepad.com/managing_computers/2007/10/split-brain-quo.html">https://techthoughts.typepad.com/managing_computers/2007/10/split-brain-quo.html</a></p>
<h2 id="TBD"><a href="#TBD" class="headerlink" title="TBD"></a>TBD</h2><p><a target="_blank" rel="noopener" href="https://etcd.io/docs/v3.4.0/demo/">https://etcd.io/docs/v3.4.0/demo/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://cloudbce.com/2020/09/29/%E5%AA%92%E4%BD%93%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wang Yian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="悟已往之不谏 知来者之可追">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/29/%E5%AA%92%E4%BD%93%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">媒体基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-29 19:12:02" itemprop="dateCreated datePublished" datetime="2020-09-29T19:12:02+08:00">2020-09-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-31 10:46:43" itemprop="dateModified" datetime="2020-10-31T10:46:43+08:00">2020-10-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/leixiaohua1020">https://blog.csdn.net/leixiaohua1020</a></p>
<h3 id="什么是视频"><a href="#什么是视频" class="headerlink" title="什么是视频"></a>什么是视频</h3><p>视频是一种有结构的数据，用工程的语言解释，我们可以把视频剖析成如下结构:</p>
<p><img src="/images/video-form.png"></img></p>
<p>内容元素 ( Content )</p>
<ul>
<li>图像 ( Image )</li>
<li>音频 ( Audio )</li>
<li>元信息 ( Metadata ) </li>
</ul>
<p>编码格式 ( Codec )</p>
<ul>
<li>Video : H.264，H.265, …</li>
<li>Audio : AAC， HE-AAC, …</li>
</ul>
<p>容器封装 (Container)</p>
<ul>
<li>MP4，MOV，FLV，RM，RMVB，AVI，…</li>
</ul>
<p>任何一个视频 Video 文件，从结构上讲，都是这样一种组成方式：</p>
<ul>
<li>由图像和音频构成最基本的内容元素；</li>
<li>图像经过视频编码压缩格式处理（通常是 H.264）</li>
<li>音频经过音频编码压缩格式处理（例如 AAC）</li>
<li>注明相应的元信息（Metadata）</li>
<li>最后经过一遍容器（Container）封装打包（例如 MP4），构成一个完整的视频文件</li>
</ul>
<h3 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h3><p>很多多媒体数据流需要同时包含音频数据和视频数据，这时通常会加入一些用于音频和视频数据同步的元数据，例如字幕。<br>这三种数据流可能会被不同的程序，进程或者硬件处理，但是当它们传输或者存储的时候，这三种数据通常是被封装在一起的。通常这种封装是通过视频文件格式来实现的。</p>
<h3 id="帧率（Frame-per-Second，FPS）"><a href="#帧率（Frame-per-Second，FPS）" class="headerlink" title="帧率（Frame per Second，FPS）"></a>帧率（Frame per Second，FPS）</h3><p>视频是由连续播放的一张张图片，在视频中，一张图片图片叫做一帧，FPS是一秒钟播放的图片（帧）的数量。<br>人类视觉的时间敏感性和分辨率根据视觉刺激的类型和特征而变化，并且在个体之间是不同的。<br>由于人类眼睛的特殊生理结构，如果所看画面之帧率高于每秒约10-12帧的时候，就会认为是连贯的，此现象称之为视觉暂留。</p>
<p>电脑游戏帧率（FPS）标准：<br>• 30 FPS——基本流畅<br>• 60 FPS——通用标准</p>
<p>但对高动态电子游戏，尤其是射击游戏或竞速游戏来说，帧率少于每秒30帧的话，游戏就会显得不连贯，但30帧仅仅是基本流畅，而非平滑连续，在实际体验中，60帧相对于30帧有着更好的体验</p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/50531482/answer/170363211">https://www.zhihu.com/question/50531482/answer/170363211</a><br><a target="_blank" rel="noopener" href="https://v.qq.com/x/page/z0500bim1ka.html">https://v.qq.com/x/page/z0500bim1ka.html</a></p>
<h3 id="GOP（Group-of-picture）"><a href="#GOP（Group-of-picture）" class="headerlink" title="GOP（Group of picture）"></a>GOP（Group of picture）</h3><p>视频是连续的图片（帧），一张图片是有m*n个像素点组成，一般来说，x和x+1帧之间像素点大部分是相同的，所以通过一定的技术，将不同的像素点记录下来，降低视频的大小，因此出现了I/B/P帧。 </p>
<p>关键帧的周期，也就是两个I帧之间的距离，一个帧组的最大帧数。增加关键帧个数可改善质量，但是同时增加带宽和网络负载。</p>
<p>需要说明的是，通过提高GOP值来提高图像质量是有限度的，在遇到场景切换的情况时，H.264编码器会自动强制插入一个I帧，此时实际的GOP值被缩短了。另一方面，在一个GOP中，P、B帧是由I帧预测得到的，当I帧的图像质量比较差时，会影响到一个GOP中后续P、B帧的图像质量，直到下一个GOP开始才有可能得以恢复，所以GOP值也不宜设置过大。</p>
<p>同时，由于P、B帧的复杂度大于I帧，所以过多的P、B帧会影响编码效率，使编码效率降低。另外，过长的GOP还会影响Seek操作的响应速度，由于P、B帧是由前面的I或P帧预测得到的，所以Seek操作需要直接定位，解码某一个P或B帧时，需要先解码得到本GOP内的I帧及之前的N个预测帧才可以，GOP值越长，需要解码的预测帧就越多，seek响应的时间也越长。</p>
<h3 id="码率"><a href="#码率" class="headerlink" title="码率"></a>码率</h3><h2 id="直播协议"><a href="#直播协议" class="headerlink" title="直播协议"></a>直播协议</h2><h2 id="FFMPEG"><a href="#FFMPEG" class="headerlink" title="FFMPEG"></a>FFMPEG</h2><h2 id="TBD"><a href="#TBD" class="headerlink" title="TBD"></a>TBD</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://cloudbce.com/2020/04/08/epoll/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wang Yian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="悟已往之不谏 知来者之可追">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/08/epoll/" class="post-title-link" itemprop="url">epoll</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-08 10:44:10 / Modified: 15:25:04" itemprop="dateCreated datePublished" datetime="2020-04-08T10:44:10+08:00">2020-04-08</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="what-is-epoll"><a href="#what-is-epoll" class="headerlink" title="what is epoll"></a>what is epoll</h2><p><a target="_blank" rel="noopener" href="https://lwn.net/Articles/14168/">sys_epoll - making poll fast</a></p>
<p>[Posted October 30, 2002 by corbet]</p>
<p>The classic Unix way to wait for I/O events on multiple file descriptors is with the select() and poll() system calls. When a process invokes one of those calls, the kernel goes through the list of interesting file descriptors, checks to see if non-blocking I/O is available on any of them, and adds the calling process to a wait queue for each file descriptor that would block. This implementation works reasonably well when the number of file descriptors is small. But if a process is managing thousands of file descriptors, the select() and poll() calls must check every single one of them, and add the calling process to thousands of wait queues. For every single call. Needless to say, this approach does not scale very well.<br>Davide Libenzi and others have been working for some time on a new approach to polling that would work for thousands of files. It was originally implemented as a special device (/dev/epoll), but, on request from Linus, the new scheme was turned into a new set of epoll() system calls. These calls work in a very different way. Every call to select() or poll() is a separate event; the data structures must be set up and torn down every time. epoll, instead, requires the application to build a persistent (across calls) data structure in kernel space first. The application starts by creating a special epoll file descriptor:</p>
<pre><code>epfd = epoll_create(int maxfds);</code></pre><p>The maxfds parameter is the maximum number of file descriptors that the process expects to manage. The return value is a file descriptor to be used with the other epoll calls; it should be shut down with close() when it is no longer needed.</p>
<p>Each file descriptor to be managed must be added to the special epoll descriptor with:</p>
<pre><code>int epoll_ctl(int epfd, int op, int fd, unsigned int events);</code></pre><p>The op parameter specifies the operation to be performed (add, change, or remove the given file descriptor fd), and events is a mask of events of interest to the process.</p>
<p>Once everything has been set up, the process can sit back and wait until there is something for it to do:</p>
<pre><code>int epoll_wait(int epfd, struct pollfd const **events, int timeout); </code></pre><p>The return value is the number of events (i.e. readable or writeable file descriptors) that epoll_wait() has found.</p>
<p>These system calls have been shown, through heavy benchmarking, to scale in constant time up to unbelievable numbers of file descriptors (some graphs can be found on this page). The persistent data structure built around the epoll file descriptor is one of the reasons for this scalability: there is no need to set it up and tear it down for every epoll_wait() call. The other half of the story is in how epoll_wait() finds the readable or writeable file descriptors. Rather than polling each file descriptor (and adding itself to wait queues), the epoll mechanism adds a callback structure onto the struct file associated with each file descriptor. When a file descriptor becomes readable or writeable, its callback(s) are called, and processes using epoll_wait() can be notified directly. So an epoll_wait() call never needs to make a pass over the list of file descriptors it is watching.</p>
<h2 id="FIFO-PIPE-amp-EPOLL"><a href="#FIFO-PIPE-amp-EPOLL" class="headerlink" title="FIFO/PIPE &amp; EPOLL"></a>FIFO/PIPE &amp; EPOLL</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_EVENTS 10</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BUF_SIZE 128</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> rc = mkfifo(msg_queue.c_str(), <span class="number">0666</span>);</span><br><span class="line">    <span class="keyword">if</span> (rc &lt; <span class="number">0</span> &amp;&amp; errno != EEXIST) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;error %m&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> rc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> fd = open(msg_queue.c_str(), O_RDONLY | O_NONBLOCK);</span><br><span class="line">    fcntl(fd, F_SETPIPE_SZ, <span class="number">4</span> * <span class="number">16</span> * sysconf(_SC_PAGESIZE));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> epoll_fd = epoll_create(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">if</span> (epoll_fd == <span class="number">-1</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;epoll_create&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">epoll_event</span> <span class="title">ev</span>, <span class="title">events</span>[<span class="title">MAX_EVENTS</span>];</span></span><br><span class="line">    ev.events = EPOLLIN | EPOLLET;</span><br><span class="line">    ev.data.fd = fd;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (epoll_ctl(epoll_fd, EPOLL_CTL_ADD, fd, &amp;ev) == <span class="number">-1</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;epoll_ctl: listen_sock&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> buf[BUF_SIZE];</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> line;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> nfds = epoll_wait(epoll_fd, events, MAX_EVENTS, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">if</span> (nfds == <span class="number">-1</span>) &#123;</span><br><span class="line">            perror(<span class="string">&quot;epoll_pwait&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">0</span>; n &lt; nfds; ++n) &#123;</span><br><span class="line">            <span class="keyword">if</span> (events[n].data.fd == fd) &#123;</span><br><span class="line">                <span class="keyword">bool</span> done = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">while</span> (!done) &#123;</span><br><span class="line">                    <span class="keyword">int</span> bytes = read(fd, buf, BUF_SIZE);</span><br><span class="line">                    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;bytes = &quot;</span> &lt;&lt; bytes &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bytes; ++i) &#123;</span><br><span class="line">                        line.append(buf + i, <span class="number">1</span>);</span><br><span class="line">                        <span class="keyword">if</span> (buf[i] == <span class="string">&#x27;\n&#x27;</span>) &#123;</span><br><span class="line">                            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;\t&quot;</span> &lt;&lt; line;</span><br><span class="line">                            line.clear();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (errno == EAGAIN) &#123;</span><br><span class="line">                        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;\tEAGAIN GOT. &quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (bytes == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>为了一次性可以将buf充满，一次read调用尽可能读取尽量多的数据，调用fcntl设置FIFO的容量。</li>
<li>将fd设置为非阻塞的， fd是否为阻塞的是由回调决定的。 单线程读取的话，应该设置为非阻塞的， 避免一个fd的read的阻塞影响其他的fd。  对于复杂的网络IO，需要再学习下开源代码的实现。</li>
<li>EAGAIN.  表示buffer已经读完了，此时可以跳出回调，等待下一次事件触发。</li>
</ul>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000018364969">https://segmentfault.com/a/1190000018364969</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://cloudbce.com/2020/02/09/graph/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wang Yian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="悟已往之不谏 知来者之可追">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/09/graph/" class="post-title-link" itemprop="url">graph</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-09 21:05:59" itemprop="dateCreated datePublished" datetime="2020-02-09T21:05:59+08:00">2020-02-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-29 16:17:10" itemprop="dateModified" datetime="2020-09-29T16:17:10+08:00">2020-09-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>[TOC]</p>
<h2 id="有向图"><a href="#有向图" class="headerlink" title="有向图"></a>有向图</h2><h3 id="表示"><a href="#表示" class="headerlink" title="表示"></a>表示</h3><p>2种表示方法， 邻接矩阵和邻接表， 前者是用2围矩阵表示连接关系，后者使用链表。 </p>
<h4 id="邻接表"><a href="#邻接表" class="headerlink" title="邻接表"></a>邻接表</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Graph</span> &#123;</span></span><br><span class="line">    Graph(<span class="keyword">int</span> nodes_nums) &#123;</span><br><span class="line">        adjusts.resize(nodes_nums);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">deque</span>&lt;<span class="keyword">int</span>&gt;&gt; adjusts;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h3><h4 id="DFS"><a href="#DFS" class="headerlink" title="DFS"></a>DFS</h4><p>DFS最直接是的使用递推， 非递归实现可以使用队列。 visted表示节点是否被访问过。  </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">const</span> Graph&amp; graph, <span class="keyword">int</span> v, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;* visted)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (visted-&gt;at(v) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    visted-&gt;at(v) = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; v;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; n : graph.adjusts[v]) &#123;</span><br><span class="line">        dfs(graph, n, visted, route);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">const</span> Graph&amp; graph, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; visted;</span><br><span class="line">    visted.resize(graph.adjusts.size(), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    dfs(graph, v, &amp;visted);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="BFS"><a href="#BFS" class="headerlink" title="BFS"></a>BFS</h4><p>BFS和DFS类似， 可以使用递归，也不可以不用，不用更加直观点, 相当于层次遍历，使用队列。 </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bfs</span><span class="params">(<span class="keyword">const</span> Graph&amp; graph, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">deque</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    q.push_back(v);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; visted;</span><br><span class="line">    visted.resize(graph.adjusts.size(), <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">        <span class="keyword">int</span> x = q.front();</span><br><span class="line">        q.pop_front();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (visted[x]) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        visted[x] = <span class="number">1</span>;     </span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; x;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> y: graph.adjusts[x]) &#123;</span><br><span class="line">            q.push_back(y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="打印环"><a href="#打印环" class="headerlink" title="打印环"></a>打印环</h3><p>判断是否存在环比较简单，但是打印所有的环的话，可以使用DFS + visted实现, visited = 0 说明没访问过， visted = 1说明存在环， visited = 2则表示</p>
<table>
<thead>
<tr>
<th align="center">visted</th>
<th align="left">表示</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="left">没被访问过</td>
</tr>
<tr>
<td align="center">1</td>
<td align="left">被访问过，存在环</td>
</tr>
<tr>
<td align="center">2</td>
<td align="left">相邻节点都被访问过了， 设置为2</td>
</tr>
</tbody></table>
<p>递归的过程中，将路径复制，发现环的时候，直接打印遍历路径。<br><strong>使用场景</strong>: 程序启动检查，防止循环调用的情况发生导致死循环。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">const</span> Graph&amp; graph, <span class="keyword">int</span> v, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;* visted, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; route)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (visted-&gt;at(v) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> x : route) &#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; x;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (visted-&gt;at(v) == <span class="number">0</span>) &#123;</span><br><span class="line">        visted-&gt;at(v) = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    route.push_back(v);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; n : graph.adjusts[v]) &#123;</span><br><span class="line">        dfs(graph, n, visted, route);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    visted-&gt;at(v) = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">const</span> Graph&amp; graph, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; visted;</span><br><span class="line">    visted.resize(graph.adjusts.size(), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; route; </span><br><span class="line">    dfs(graph, v, &amp;visted, route);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="拓扑排序"><a href="#拓扑排序" class="headerlink" title="拓扑排序"></a>拓扑排序</h3><p>对一个有向无环图(Directed Acyclic Graph简称DAG)G进行拓扑排序，是将G中所有顶点排成一个线性序列，<strong>使得图中任意一对顶点u和v，若边&lt;u,v&gt;∈E(G)，则u在线性序列中出现在v之前</strong>。通常，这样的线性序列称为满足拓扑次序(Topological Order)的序列，简称拓扑序列。简单的说，由某个集合上的一个偏序得到该集合上的一个全序，这个操作称之为拓扑排序。</p>
<p><a target="_blank" rel="noopener" href="https://leetcode.com/problems/course-schedule-ii/solution/">https://leetcode.com/problems/course-schedule-ii/solution/</a></p>
<h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><p>方法一，是结合了DFS和Stack的巧妙的方法。  DFS是对于边&lt;u,v&gt;是先遍历u，再遍历v, 但是，并不一定会满足u在线性序列中排在v的前面。 在DFS中，先将与u相关联的点都DFS完后，将u压如栈，DFS结束后，将栈reverse就是拓扑的次序。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Graph</span> &#123;</span></span><br><span class="line">    Graph(<span class="keyword">int</span> nodes_nums) &#123;</span><br><span class="line">        adjusts.resize(nodes_nums);</span><br><span class="line">        visited.resize(nodes_nums);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">deque</span>&lt;<span class="keyword">int</span>&gt;&gt; adjusts;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; visited;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> &#123;</span><br><span class="line">    WHITE = <span class="number">0</span>,</span><br><span class="line">    GRAY = <span class="number">1</span>,</span><br><span class="line">    BLACK = <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">dfs</span><span class="params">(Graph* g, <span class="keyword">int</span> v, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;* route)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (g-&gt;visited[v] == GRAY) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    g-&gt;visited[v] = GRAY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> n : g-&gt;adjusts[v]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (g-&gt;visited[n] == GRAY) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (g-&gt;visited[n] == WHITE) &#123;</span><br><span class="line">            <span class="keyword">if</span> (dfs(g, n, route) == <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    g-&gt;visited[v] = BLACK;</span><br><span class="line">    route-&gt;push_back(v);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sort</span><span class="params">(Graph* g)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; route;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; g-&gt;adjusts.size(); ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (g-&gt;visited[i] == WHITE) &#123;</span><br><span class="line">            <span class="keyword">if</span> (dfs(g, i, &amp;route) == <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> it = route.rbegin(); it != route.rend(); ++it) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; *it &lt;&lt; <span class="string">&quot;-&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><p>方法二是使用经典的入度为0法，也是先访问入度为0的点，然后将入度为0的点的关联顶点的入度-1，进行迭代，使用队列的方式。 </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Graph</span> &#123;</span></span><br><span class="line">    Graph(<span class="keyword">int</span> nodes_num) &#123;</span><br><span class="line">        adjusts.resize(nodes_num);</span><br><span class="line">        indegree.resize(nodes_num);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        adjusts[start].push_back(end);</span><br><span class="line">        indegree[end]++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sort</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; indegree;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; adjusts;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Graph::sort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">deque</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; indegree.size(); ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (indegree[i] == <span class="number">0</span>) &#123;</span><br><span class="line">            q.push_back(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (q.empty()) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;impossible&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="built_in">list</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = q.front();</span><br><span class="line">        q.pop_front();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">list</span>.push_back(v);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> n : adjusts[v]) &#123;</span><br><span class="line">            --indegree[n];</span><br><span class="line">            <span class="keyword">if</span> (indegree[n] == <span class="number">0</span>) &#123;</span><br><span class="line">                q.push_back(n);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">list</span>.size() != indegree.size()) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;impossible&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> x: <span class="built_in">list</span>) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="无向图"><a href="#无向图" class="headerlink" title="无向图"></a>无向图</h2><p>无向图可以，我觉得可以就理解为双向图。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://cloudbce.com/2020/01/20/lcs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wang Yian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="悟已往之不谏 知来者之可追">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/20/lcs/" class="post-title-link" itemprop="url">lcs</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-20 22:30:17" itemprop="dateCreated datePublished" datetime="2020-01-20T22:30:17+08:00">2020-01-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-30 16:59:17" itemprop="dateModified" datetime="2020-09-30T16:59:17+08:00">2020-09-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>LeetCode有位老哥对动态规划的各种题目做了归纳总结: <a target="_blank" rel="noopener" href="https://leetcode.com/discuss/general-discussion/458695/dynamic-programming-patterns">https://leetcode.com/discuss/general-discussion/458695/dynamic-programming-patterns</a><br>写的非常好。 </p>
<h3 id="最长公共子序列"><a href="#最长公共子序列" class="headerlink" title="最长公共子序列"></a><a target="_blank" rel="noopener" href="https://leetcode.com/problems/longest-common-subsequence/">最长公共子序列</a></h3><p>递推公式。 2个字符串， 得要有二维的数组存储最值。dp[i][j]表示A[i]和B[j]结尾的字符串的最值，那么递推公式是考虑A[i]和B[j]是否相等</p>
<p>A[i] == B[j] —-&gt; dp[i][j] = dp[i-1][j-1] + 1;<br>A[i] != B[j] —-&gt; dp[i][j] = std::max(dp[i][j-1], dp[i-1][j])</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">longestCommonSubsequence</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; text1, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; text2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m = text1.size();</span><br><span class="line">    <span class="keyword">int</span> n = text2.size();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> dp[m+<span class="number">1</span>][n+<span class="number">1</span>];</span><br><span class="line">    bzero(dp, (m + <span class="number">1</span>) * (n + <span class="number">1</span>) * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (text1[i - <span class="number">1</span>] == text2[j - <span class="number">1</span>]) &#123;</span><br><span class="line">                dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dp[i][j] = <span class="built_in">std</span>::max(dp[i][j<span class="number">-1</span>], dp[i<span class="number">-1</span>][j]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            res = <span class="built_in">std</span>::max(res, dp[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="最长公共子串"><a href="#最长公共子串" class="headerlink" title="最长公共子串"></a>最长公共子串</h3><p>最长公共子串和最长公共子序列基本是相同的递推公式，不同点在于A[i] != B[j]的时候， 那么dp[i][j] == 0的， 因为A[i]和B[j]结尾的不相同，说明不在公共子串里面的。 </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">longestCommonSubstr</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; text1, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; text2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m = text1.size();</span><br><span class="line">    <span class="keyword">int</span> n = text2.size();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> dp[m+<span class="number">1</span>][n+<span class="number">1</span>];</span><br><span class="line">    bzero(dp, (m + <span class="number">1</span>) * (n + <span class="number">1</span>) * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (text1[i - <span class="number">1</span>] == text2[j - <span class="number">1</span>]) &#123;</span><br><span class="line">                dp[i][j] = dp[i - <span class="number">1</span>][j - <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">            &#125; </span><br><span class="line"></span><br><span class="line">            res = <span class="built_in">std</span>::max(res, dp[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="https://cloudbce.com/2020/01/12/sliding-window/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wang Yian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="悟已往之不谏 知来者之可追">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/12/sliding-window/" class="post-title-link" itemprop="url">sliding_window</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-01-12 21:02:23 / Modified: 22:21:18" itemprop="dateCreated datePublished" datetime="2020-01-12T21:02:23+08:00">2020-01-12</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>A sliding window is an abstract concept commonly used in array/string problems. A window is a range of elements in the array/string which usually defined by the start and end indices, i.e. [i, j)(left-closed, right-open). A sliding window is a window “slides” its two boundaries to the certain direction. </p>
<p>For example, if we slide [i, j)[i,j) to the right by 11 element, then it becomes [i+1, j+1)[i+1,j+1) (left-closed, right-open).</p>
<h3 id="LeetCode-Problem"><a href="#LeetCode-Problem" class="headerlink" title="LeetCode Problem"></a>LeetCode Problem</h3><h4 id="Longest-Substring-Without-Repeating-Characters"><a href="#Longest-Substring-Without-Repeating-Characters" class="headerlink" title="Longest Substring Without Repeating Characters"></a><a target="_blank" rel="noopener" href="https://leetcode.com/problems/longest-substring-without-repeating-characters/">Longest Substring Without Repeating Characters</a></h4><p>Solution里面有详细的解题方法。  这里记录下自己的理解。  最优化的滑动窗口是计算当前最后一个字符串结尾的子串的最大连续不重复子串的长度，更新窗口和长度， 本身是回头看的一个方式。  暴力解法则是向前看的方式。 </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> hash_map[<span class="number">256</span>] = &#123;<span class="number">-1</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> start = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.size(); ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hash_map[s[i]] &gt; start) &#123;</span><br><span class="line">            start = hash_map[s[i]];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        hash_map[s[i]] = i;</span><br><span class="line">        len = <span class="built_in">std</span>::max(len, i - start);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> len;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Wang Yian</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/pianzhoujun" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;pianzhoujun" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wang Yian</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v5.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.6.0
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>
















  

  

</body>
</html>
